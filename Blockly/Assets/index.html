<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <title>Hello, world!</title>
</head>
<body>
    <div class="container-fluid p-0">
        <div id="blocklyDiv" style="height: 396px; width: 100%"></div>


        <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
               
        </xml>


        <xml xmlns="https://developers.google.com/blockly/xml" id="startBlocks" style="display: none">
            <block type="graph_set_y" deletable="false" x="100" y="100">
                <value name="VALUE">

                </value>
            </block>
        </xml>
    </div>


        <script src="jquery-3.6.0.min.js"></script>
        <!-- Optional JavaScript; choose one of the two! -->
        <!-- Option 1: Bootstrap Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

        <!-- Option 2: Separate Popper and Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>

        <script src="blocks/blockly_compressed.js"></script>
        <script src="blocks/blocks_compressed.js"></script>
        <script src="blocks/pt-br.js"></script>
        <script>
            var demoWorkspace
            Blockly.defineBlocksWithJsonArray([{
                "type": "from_a",
                "message0": "A",
                "output": "Number",
                "colour": Blockly.Msg['VARIABLES_HUE'],
                "tooltip": Blockly.Msg['VARIABLES_GET_TOOLTIP'],
                "helpUrl": Blockly.Msg['VARIABLES_GET_HELPURL']
            }]);

            Blockly.defineBlocksWithJsonArray([{
                "type": "from_b",
                "message0": "B",
                "output": "Number",
                "colour": Blockly.Msg['VARIABLES_HUE'],
                "tooltip": Blockly.Msg['VARIABLES_GET_TOOLTIP'],
                "helpUrl": Blockly.Msg['VARIABLES_GET_HELPURL']
            }]);

            Blockly.defineBlocksWithJsonArray([{
                "type": "from_c",
                "message0": "C",
                
                "output": "Number",
                "colour": Blockly.Msg['VARIABLES_HUE'],
                "tooltip": Blockly.Msg['VARIABLES_GET_TOOLTIP'],
                "helpUrl": Blockly.Msg['VARIABLES_GET_HELPURL']
            }]);

            Blockly.defineBlocksWithJsonArray([{
                "type": "form_set_s",
                "message0": "S = %1",
                "args0": [
                    {
                        "type": "input_value",
                        "name": "VALUE",
                        "check": "Number"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": Blockly.Msg['VARIABLES_HUE'],
                "tooltip": Blockly.Msg['VARIABLES_SET_TOOLTIP'],
                "helpUrl": Blockly.Msg['VARIABLES_SET_HELPURL']
            }]);


            $(function () {

                $.ajax({
                    url: "http://localhost:9090/api/toolbox/get",
                    context: document.body
                }).done(function (data) {
                    $('#toolbox').html(data);
                    console.log($('#toolbox').html());
                    
                    demoWorkspace = Blockly.inject('blocklyDiv',
                        {
                            media: 'blocks/media/',
                            toolbox: document.getElementById('toolbox')
                        });

                    //Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),demoWorkspace);
                    demoWorkspace.clearUndo();
                });

                
            });

            function clik() {

                //Blockly.Variables.createVariable(demoWorkspace, null, 'panda');

                //var xmlDom = Blockly.Xml.textToDom('<xml xmlns="https://developers.google.com/blockly/xml"><block type="controls_if" id="m`jA?Nzp[!jM7^zBlM}=" x="488" y="288"><value name="IF0"><block type="logic_operation" id="K-^`/BG5.=3xH{HZ}t/~"><field name="OP">AND</field></block></value></block></xml>');
                //Blockly.Xml.domToWorkspace(xmlDom, demoWorkspace);


                var xmlDom = Blockly.Xml.workspaceToDom(demoWorkspace);
                var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
                return xmlText;
            }

        </script>

</body>
</html>